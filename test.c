#include <stdint.h>
#include <stdio.h>

enum {
	TRUE = (0 == 0),
	FALSE = (0 != 0),
	NUM_IMMS_RAW = 76,
	NUM_IMMS_RORED = 1201,
};

union entry {
	struct {
		uint16_t index : 11;
		uint16_t operation : 2;
		uint16_t card : 3;
	};
	uint16_t raw;
};

static const uint32_t imms_raw[NUM_IMMS_RAW] = {
	0x00,
	0xa1,0xa2,0xa3,0xa4,0xa5,0xa6,0xa7,0xa8,0xa9,0xaa,0xab,0xac,0xad,0xae,
	0xb0,0xb1,0xb2,0xb3,0xb4,0xb5,0xb6,0xb8,0xba,0xbb,0xbc,0xbd,0xbe,0xbf,
	0xc0,0xc1,0xc2,0xc3,0xc4,0xc5,0xc6,0xc7,0xc8,0xc9,0xca,0xcb,0xcc,0xcd,0xce,0xcf,
	0xd0,0xd1,0xd2,0xd3,0xd4,0xd5,0xd6,0xd7,0xd8,0xd9,0xda,0xdb,0xdc,0xdd,0xde,0xdf,
	0xe0,0xe1,0xe2,0xe3,0xe4,0xe5,0xe6,0xe7,0xe8,0xe9,0xea,0xeb,0xec,0xed,0xee,
};
static uint32_t imms[NUM_IMMS_RORED];

int main(void)
{
	FILE *file = fopen("database.raw", "r");
	unsigned idx = 1;
	for (int i = 0; i < 16; i += 1) {
		for (unsigned j = 1; j < NUM_IMMS_RAW; j += 1) {
			uint32_t imm = imms_raw[j];
			uint32_t imm_rored = (imm >> (i * 2)) | (imm << (32 - (i * 2)));
			imms[idx++] = imm_rored;
		}
	}

	uint32_t num;
	union entry ent;
	while (TRUE) {
		printf("Enter the number in hex: ");
		scanf("%x", &num);
		fseek(file, num*2, SEEK_SET);
		fread(&ent.raw, 2, 1, file);
		printf("%08x, %s, %d\n", imms[ent.index], (const char*[4]){"ADC", "SBC", "invalid", "invalid"}[ent.operation], ent.card);
	}
	fclose(file);
	return 0;
}
